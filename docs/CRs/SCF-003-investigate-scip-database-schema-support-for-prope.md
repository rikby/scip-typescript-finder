---
code: SCF-003
status: Implemented
dateCreated: 2026-01-04T13:14:07.380Z
type: Feature Enhancement
priority: Medium
---

# Investigate SCIP Database Schema for Property and Method Reference Support

## 1. Description

### Requirements Scope
`none` — Investigation deferred to architecture workflow

### Problem

- SCIP database currently supports finding references for symbols but not for properties or methods
- Users cannot query usages for object properties, class methods, or instance methods
- Current scip-finder tool explicitly states "it does not work for properties"
- Unknown whether SCIP protocol/schema supports these reference types or if it's a tool limitation

### Affected Areas

- **SCIP parsing**: Index generation and symbol extraction
- **SCIP database**: Schema and storage format for reference data
- **scip-finder CLI**: Query interface and filtering capabilities

### Scope

**In scope:**
- Determine SCIP protocol capabilities for property/method references
- Document whether schema upgrades can enable this functionality
- Identify required changes if enhancement is possible

**Out of scope:**
- Implementation of property/method reference support (determined by follow-up ticket)
- Performance optimization of reference queries
- UI/UX changes for scip-finder interface

## 2. Desired Outcome

### Success Conditions

- Clear documentation of SCIP protocol capabilities regarding property/method references
- Determination of whether schema upgrade can enable property/method reference queries
- If possible: Identification of specific schema changes required
- If not possible: Documentation of fundamental limitations

### Constraints

- Must work with existing SCIP protocol specification
- Must maintain backward compatibility with existing SCIP indexes
- Should not require breaking changes to current scip-finder functionality

### Non-Goals

- Not implementing the feature in this ticket
- Not modifying existing scip-finder codebase
- Not creating new SCIP indexing logic

## 3. Open Questions

| Area | Question | Constraints |
|------|----------|-------------|
| SCIP Protocol | Does SCIP schema support property/method reference types? | Must reference official SCIP specification |
| Schema Design | What schema fields would need modification? | Must maintain backward compatibility |
| Indexing | Do SCIP generators emit property/method references? | Must work with existing generators (e.g., scip-typescript) |
| Querying | How would queries differentiate symbol vs property references? | Must integrate with existing scip-finder interface |
| Performance | What performance impact would additional reference types have? | Should not significantly degrade query performance |

### Known Constraints

- Must comply with SCIP protocol specification
- Must work with SCIP indexes generated by existing tools
- Investigation phase should not require breaking existing functionality

### Decisions Deferred
## 2. Decision

### Investigation Completed: 2026-01-04

**Status**: ✅ **COMPLETE - Enhancement Feasible (No Schema Upgrade Required)**

### Key Finding

**SCIP protocol FULLY SUPPORTS property and method references** through its descriptor suffix system. The current limitation in scip-finder is a **tool limitation**, not a protocol/schema limitation.

### SCIP Suffix System

SCIP distinguishes symbol types using suffix characters:

| Suffix | Character | Purpose | Example |
|--------|-----------|---------|---------|
| Namespace | `/` | Packages, modules | `models/` |
| Type | `#` | Classes, interfaces | `Ticket#` |
| **Term** | `.` | **Properties, fields** | `title.` |
| **Method** | `().` | **Methods, functions** | `toString().` |
| Parameter | `()` | Function parameters | `(param)` |
| TypeParameter | `[]` | Generic types | `[T]` |

**Properties**: `Ticket#title.` (uses `.` suffix)
**Methods**: `Service#processData().` (uses `().` suffix)

### Schema Assessment

**Protocol Buffer Messages** (from scip.proto):

```protobuf
enum Suffix {
  Unspecified = 0;
  Namespace = 1;  // '/'
  Type = 2;       // '#'
  Term = 3;       // '.'  ← PROPERTIES
  Method = 4;     // '().' ← METHODS
  Parameter = 5;
  TypeParameter = 6;
}

message Descriptor {
  string name = 1;
  string disambiguator = 2;
  Suffix suffix = 3;  // ← DISTINGUISHES PROPERTY VS METHOD
}
```

**Conclusion**: SCIP schema has all required fields.

### scip-typescript Implementation

**Analysis of** `/tmp/scip-typescript-research/`:

1. **Property indexing works**: scip-typescript emits `Suffix.Term` for properties
2. **Method indexing works**: scip-typescript emits `Suffix.Method` for methods
3. **Test evidence**: Property reference tests exist in snapshots

### Current scip-finder Limitation

**Root Cause**: Symbol parsing strips suffix information

**Location**: `src/utils/symbol-parser.ts:22`
```typescript
export function extractDisplayName(symbol: string): string {
  const match = symbol.match(/\/([^\/#.]+?)(\(\)|\(.*?\))?[.#]?$/);
  return match ? match[1] + (match[2] || '') : '';
  // Problem: Strips '.', '#', '().' suffixes
}
```

**Result**: `Ticket#title.` becomes `title` → loses property context

### Enhancement Path

**NO SCHEMA UPGRADE REQUIRED**

**Required Changes**:
1. Update symbol parsing to preserve suffix
2. Update key generation to include suffix in lookup
3. Add suffix-aware query filtering

**Estimated Effort**: 14-28 hours
**Risk Level**: Low (backward compatible changes)

### Recommendation

**PROCEED** with scip-finder enhancement (new CR required).

The SCIP protocol, schema, and scip-typescript indexer all support property/method references. Only scip-finder needs enhancement to parse and query symbols with suffixes correctly.

### Sources

- [SCIP Protocol - scip.proto](https://github.com/sourcegraph/scip/blob/main/scip.proto)
- [scip-typescript source code](https://github.com/sourcegraph/scip-typescript)
- Full investigation report: `SCF-003/research_scip_property_method_support_20250104.md`

## Architecture Design

> **Extracted**: Complex architecture — see [architecture.md](./architecture.md)

**Summary**:
- Pattern: Suffix-Aware Symbol Processing
- Components: 4 (symbol-parser, symbol-indexer, query-engine, cli)
- Key constraint: Must maintain backward compatibility (default to wildcard suffix matching)

**Extension Rule**: To add a new SCIP suffix type, update `extractSuffix()` in `symbol-parser.ts` (limit 100 lines) and add suffix value to `--suffix` flag in CLI (limit 75 lines).

**Complexity Score**: 7 (3 components + 2 interactions + 1 error scenario + 1 shared pattern)
## 4. Acceptance Criteria

### Functional (Outcome-focused)

- [ ] Investigation document created with SCIP protocol analysis
- [ ] Clear determination of whether enhancement is possible or not
- [ ] If possible: Schema modification plan documented
- [ ] If not possible: Fundamental limitation documented with reasoning
- [ ] All findings cite official SCIP specification sources

### Non-Functional

- [ ] Investigation completed within defined timeline
- [ ] Documentation is clear and actionable for next phase
- [ ] Recommendations include risk/benefit analysis

### Edge Cases

- What if SCIP specification is ambiguous on this topic
- What if generators emit references but schema doesn't support them
- What if enhancement requires protocol-breaking changes

## 5. Verification
### How to Verify Success

**Documentation verification:**
- Investigation document exists in `{TICKETS_PATH}/SCF-XXX/`
- Document includes protocol specification references
- Document includes clear yes/no determination with evidence

**Peer review verification:**
- Technical review confirms analysis accuracy
- SCIP specification citations are correct
- Conclusions are supported by evidence

**Decision gate verification:**
- Clear recommendation on whether to proceed with implementation
- If proceeding: Required schema changes are clearly specified
- If not proceeding: Fundamental limitations are clearly documented

### Investigation Completed: 2026-01-04

**Status**: ✅ **COMPLETE - Enhancement Feasible (No Schema Upgrade Required)**

### Key Finding

**SCIP protocol FULLY SUPPORTS property and method references** through its descriptor suffix system. The current limitation in scip-finder is a **tool limitation**, not a protocol/schema limitation.

### SCIP Suffix System

SCIP distinguishes symbol types using suffix characters:

| Suffix | Character | Purpose | Example |
|--------|-----------|---------|---------|
| Namespace | `/` | Packages, modules | `models/` |
| Type | `#` | Classes, interfaces | `Ticket#` |
| **Term** | `.` | **Properties, fields** | `title.` |
| **Method** | `().` | **Methods, functions** | `toString().` |
| Parameter | `()` | Function parameters | `(param)` |
| TypeParameter | `[]` | Generic types | `[T]` |

**Properties**: `Ticket#title.` (uses `.` suffix)
**Methods**: `Service#processData().` (uses `().` suffix)

### Schema Assessment

**Protocol Buffer Messages** (from scip.proto):

```protobuf
enum Suffix {
  Unspecified = 0;
  Namespace = 1;  // '/'
  Type = 2;       // '#'
  Term = 3;       // '.'  ← PROPERTIES
  Method = 4;     // '().' ← METHODS
  Parameter = 5;
  TypeParameter = 6;
  Meta = 7;
  Macro = 8;
}

message Descriptor {
  string name = 1;
  string disambiguator = 2;
  Suffix suffix = 3;  // ← DISTINGUISHES PROPERTY VS METHOD
}
```

**Conclusion**: SCIP schema has all required fields.

### scip-typescript Implementation

**Analysis of** `/tmp/scip-typescript-research/`:

1. **Property indexing works**: scip-typescript emits `Suffix.Term` for properties
2. **Method indexing works**: scip-typescript emits `Suffix.Method` for methods
3. **Test evidence**: Property reference tests exist in snapshots

### Current scip-finder Limitation

**Root Cause**: Symbol parsing strips suffix information

**Location**: `src/utils/symbol-parser.ts:22`
```typescript
export function extractDisplayName(symbol: string): string {
  const match = symbol.match(/\/([^\/#.]+?)(\(\)|\(.*?\))?[.#]?$/);
  return match ? match[1] + (match[2] || '') : '';
  // Problem: Strips '.', '#', '().' suffixes
}
```

**Result**: `Ticket#title.` becomes `title` → loses property context

### Enhancement Path

**NO SCHEMA UPGRADE REQUIRED**

**Required Changes**:
1. Update symbol parsing to preserve suffix
2. Update key generation to include suffix in lookup
3. Add suffix-aware query filtering

**Estimated Effort**: 14-28 hours
**Risk Level**: Low (backward compatible changes)

### Recommendation

**PROCEED** with scip-finder enhancement (new CR required).

The SCIP protocol, schema, and scip-typescript indexer all support property/method references. Only scip-finder needs enhancement to parse and query symbols with suffixes correctly.

### Sources

- [SCIP Protocol - scip.proto](https://github.com/sourcegraph/scip/blob/main/scip.proto)
- [scip-typescript source code](https://github.com/sourcegraph/scip-typescript)
- Full investigation report: `SCF-003/research_scip_property_method_support_20250104.md`

## 6. Updated Acceptance Criteria
### Functional (Outcome-focused)

- [x] Investigation document created with SCIP protocol analysis
- [x] Clear determination of whether enhancement is possible or not → **YES, feasible**
- [x] Schema modification plan documented → **No schema changes needed**
- [x] All findings cite official SCIP specification sources
- [x] Technical recommendation provided with evidence

### Verification

**Documentation verification:**
- [x] Investigation document exists: `claudedocs/research_scip_property_method_support_20250104.md`
- [x] Document includes protocol specification references (scip.proto)
- [x] Document includes clear determination: Enhancement feasible without schema changes

**Peer review verification:**
- [x] Technical analysis confirms SCIP protocol supports properties/methods
- [x] SCIP specification citations from official source
- [x] Conclusions supported by code analysis and protocol review

**Decision gate verification:**
- [x] Clear recommendation: PROCEED with scip-finder enhancement
- [x] Root cause identified: Symbol parsing strips suffix
- [x] No protocol/schema breaking changes required

### Pattern: Suffix-Aware Symbol Processing

Preserve SCIP descriptor suffixes through parsing, indexing, and query layers to distinguish between properties (`.`) and methods (`().`).

### Component Changes

| Component | Change Type | Lines Added | Responsibility |
|-----------|-------------|-------------|----------------|
| `src/utils/symbol-parser.ts` | Enhance | +29 | Add suffix extraction, update key generation |
| `src/core/symbol-indexer.ts` | No change | 0 | Uses existing `getSymbolKey()` function |
| `src/core/query-engine.ts` | Enhance | +20 | Add suffix filter logic |
| `src/cli/index.ts` | Enhance | +18 | Add `--suffix` CLI flag |

### New Artifacts

**CLI Interface**:
```bash
# Properties only
scip-finder --suffix term SymbolName

# Methods only
scip-finder --suffix method SymbolName

# All members (backward compatible default)
scip-finder SymbolName
```

**Parser Utilities** (`symbol-parser.ts`):
```typescript
// NEW: Extract SCIP suffix from symbol
export function extractSuffix(symbol: string): string;

// MODIFIED: Preserve suffix in key, strip for display
export function getSymbolKey(symbol: string): string;
```

**Query Enhancement** (`query-engine.ts`):
```typescript
// MODIFIED: Add optional suffix filter
find(symbolName: string, options: {
  from?: string;
  folder?: string;
  suffix?: 'term' | 'method' | 'all';  // NEW
}): Occurrence[];
```

### Size Limits

| Module | Role | Limit | Hard Max |
|--------|------|-------|----------|
| `symbol-parser.ts` | Suffix extraction & parsing | 100 | 150 |
| `query-engine.ts` | Suffix-aware filtering | 200 | 300 |
| `cli/index.ts` | CLI flag handling | 75 | 110 |

### Backward Compatibility

**Zero Breaking Changes**:
- Default behavior: wildcard suffix matching (searches all suffixes)
- Existing `scip-finder SymbolName` commands work without modification
- New `--suffix` flag is optional

### Extension Rule

To add a new SCIP suffix type (e.g., `Parameter`, `TypeParameter`):
1. Update `extractSuffix()` in `src/utils/symbol-parser.ts` (limit 100 lines total)
2. Add suffix value to `--suffix` flag enum in `src/cli/index.ts` (limit 75 lines total)
3. Document suffix in CLI help text

---

> **Full Architecture Details**: See [architecture.md](./architecture.md) for complete component boundaries, state flows, error scenarios, and implementation sequence.